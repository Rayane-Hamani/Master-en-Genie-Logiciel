#include "assert.h"
#include "ctx_list.h"



int ctx_lst_isempty(ctx_lst_t *l)
{
  return (l->next == l);
}



void ctx_lst_init(ctx_lst_t *l)
{
  l->next = l;
  l->prev = l;
}

void ctx_lst_insert(ctx_lst_t *l, ctx_t* ctx)
{
  // forward links
  ctx->next = l->next;
  l->next->prev = ctx;

  // backward links
  ctx->prev = l;
  l->next = ctx;

  // prev is still pointing to the placeholder
}



struct ctx_s* ctx_lst_remove(ctx_lst_t *l, ctx_t* ctx)
{
  if(ctx_lst_isempty(l))
    return NULL;

  ctx_t* p = l->next;

  while(p != l)
  {
    if(p == ctx)
      break;

    p = p->next;
  }

  if(p == l) // not found, return
    return NULL;

  p->prev->next = p->next;
  p->next->prev = p->prev;

  return p;
}

struct ctx_s* ctx_lst_next(ctx_lst_t *l, ctx_t* curr)
{
  assert(l != l->next);

  if(curr == NULL)
    return l->next;

  if(curr->next != l)
    return curr->next;

  return curr->next->next;
}

struct ctx_s* ctx_lst_first(ctx_lst_t *l)
{
  assert(l != l->next);

  return l->next;
}