#ifndef _CTX_
#define _CTX_



#define MAGIC 0x42424242



typedef void (*func_t) (void*);



enum etat_e {INIT, ACTIF, VEROUILLE, TERMINE};



struct ctx_s
{
    void* sp;
    void* bp;
    void* stack;

    func_t f;
    void* f_args;
    enum etat_e etat;

    struct ctx_s* suivant;
    struct ctx_s* sem_suivant;
    
    unsigned int magic;
};



struct ctx_s* ctx_courant = NULL;
struct ctx_s* ctx_anneau  = NULL;

struct ctx_s ctx_ping; 
struct ctx_s ctx_pong;



void init_ctx(struct ctx_s *ctx, int stack_size, func_t f, void* f_args);
void switch_to_ctx(struct ctx_s *ctx);

void create_ctx(int stack_size, func_t f, void* f_args);
void yield();



#define TIMER_ALARM  0xF8
#define TIMER_IRQ    2
#define TIMER_PARAM  0xF4

void start_sched();



void f_ping();
void f_pong();

void irq_disable();
void irq_enable();


#endif