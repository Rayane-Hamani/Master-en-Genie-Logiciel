#######################################################################
############################## LIBRARIES ##############################
#######################################################################

# JVMTI

JDK         = /usr/lib/jvm/java-15-oracle
JVMTI       = $(JDK)/include
JNI_MD      = $(JDK)/include/linux

# Glib 2.0

GLIB        = /usr/include/glib-2.0
GLIBCONFIG  = /usr/lib/x86_64-linux-gnu/glib-2.0/include

#######################################################################

LIBS        = -I$(JVMTI) -I$(JNI_MD) -I$(GLIB) -I$(GLIBCONFIG)

#######################################################################





#######################################################################
#################### COMPILATION AND LINK EDITION #####################
#######################################################################

# C compiler and linker

CC          =  gcc

# Options for compiling

CFLAGS      = -Wall -Wextra -fPIC -O2

# Options for link editing

LDFLAGS     = -shared -lglib-2.0

#######################################################################

COMPILATION = $(CC) $(CFLAGS) $(LIBS)

LINKEDITION = $(CC) $(LDFLAGS) $(LIBS)

#######################################################################





#######################################################################
############################### BUILDS ################################
#######################################################################

# Name of the executables

ALL:= agent.so

#######################################################################

all: $(ALL)

agent.so: src/agent.o src/agent_util.o src/cpu_usage.o
	$(LINKEDITION) -o $@ $^

src/%.o: src/%.c
	$(COMPILATION) -o $@ -c $<

#######################################################################





#######################################################################
############################## CLEANING ###############################
#######################################################################

clean:
	rm -f core src/*.o

realclean: clean
	rm -f $(ALL)

#######################################################################





.PHONY: all clean realclean