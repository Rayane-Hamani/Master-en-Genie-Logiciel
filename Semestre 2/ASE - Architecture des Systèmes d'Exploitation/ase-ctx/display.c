#include <assert.h>
#include <stdio.h>
#include <stdlib.h>



int nb_octets = 40;



void rec(int nb_iter, int a, int b, int c)
{
    int x = 0xCAFE0042;
    void *sp;
    void *bp;
    int y = 0xDEADBEEF;

    printf("rec:  %p\n", &rec);
    printf("nbit: %p\n", &nb_iter);
    printf("a:    %p\n", &a);
    printf("b:    %p\n", &b);
    printf("c:    %p\n", &c);
    printf("x:    %p\n", &x);
    printf("y:    %p\n", &y);

    asm("mov %%rsp, %0"
        "\n\t"
        "mov %%rbp, %1"
       : "=r"(sp), "=r"(bp));

    printf("sp:   %p\n", sp);
    printf("bp:   %p\n", bp);

    if(nb_iter > 1)
        rec(nb_iter-1, b, c, a);
    else
    {
        int i;
        for(i = 0; i < nb_octets; i++)
            fprintf(stderr, "%c", ((char*)sp)[i]);
    }
}



int main(int argc, char *argv[])
{
    int nb_iter = 3;

    printf("main: %p\n", &main);
    printf("argc: %p\n", &argc);
    printf("argv: %p\n", &argv);

    if(argc > 1)
        nb_iter = strtol(argv[1], NULL, 10);
    if(argc > 2)
        nb_octets = strtol(argv[2], NULL, 10);

    rec(nb_iter, 0x12345678, 0x9ABCDEF0, 0x87654321);

    return 0;
}
